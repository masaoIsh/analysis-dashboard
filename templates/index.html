{% extends "base.html" %}

{% block title %}CBDC/Stablecoin Analysis Dashboard{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div class="header-content">
        <div class="header-info">
            <h1>CBDC/Stablecoin Analysis</h1>
            <p>Real-time insights into Central Bank Digital Currencies and Stablecoin markets</p>
        </div>
        <div class="header-actions">
            <div class="time-filter">
                <select id="timeFilter" class="time-select">
                    <option value="1d">Last 24 Hours</option>
                    <option value="7d" selected>Last 7 Days</option>
                    <option value="30d">Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Key Metrics Dashboard -->
<div class="metrics-dashboard">
    <div class="metrics-grid">
        <div class="metric-card primary">
            <div class="metric-header">
                <h3>Total Market Cap</h3>
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="metric-value">$2.4T</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                +5.2%
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <h3>CBDC Projects</h3>
                <i class="fas fa-building"></i>
            </div>
            <div class="metric-value">87</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                +3
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <h3>Stablecoin Volume</h3>
                <i class="fas fa-exchange-alt"></i>
            </div>
            <div class="metric-value">$89.2B</div>
            <div class="metric-change negative">
                <i class="fas fa-arrow-down"></i>
                -2.1%
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <h3>Active Users</h3>
                <i class="fas fa-users"></i>
            </div>
            <div class="metric-value">12.4M</div>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up"></i>
                +8.7%
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="charts-section">
    <div class="charts-grid">
        <!-- Market Cap Distribution Chart -->
        <div class="chart-card large">
            <div class="chart-header">
                <h3>Market Cap Distribution</h3>
                <div class="chart-actions">
                    <button class="chart-btn active" data-chart="market-cap">Market Cap</button>
                    <button class="chart-btn" data-chart="volume">Volume</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="marketCapChart" width="400" height="200"></canvas>
            </div>
        </div>
        
        <!-- CBDC Adoption Timeline -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>CBDC Adoption Timeline</h3>
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="chart-container">
                <canvas id="adoptionChart" width="300" height="200"></canvas>
            </div>
        </div>
        
        <!-- Stablecoin Performance -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>Top Stablecoins</h3>
                <i class="fas fa-coins"></i>
            </div>
            <div class="chart-container">
                <canvas id="stablecoinChart" width="300" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Analysis Notebooks -->
<div class="analysis-section">
    <div class="section-header">
        <h2>Latest Analysis</h2>
        <div class="section-actions">
            <a href="{{ url_for('upload_notebook') }}" class="upload-btn">
                <i class="fas fa-plus"></i>
                Share Analysis
            </a>
        </div>
    </div>
    
    {% if notebooks %}
    <div class="notebooks-grid" id="notebooksContainer">
        {% for notebook in notebooks %}
        <div class="notebook-card">
            <a href="{{ url_for('view_notebook', notebook_id=notebook.id) }}" class="notebook-link">
                <div class="notebook-header">
                    <h3>{{ notebook.title }}</h3>
                    <span class="notebook-date">{{ notebook.created_at.strftime('%b %d, %Y') }}</span>
                </div>
                <p class="notebook-description">
                    {{ notebook.description[:100] }}{% if notebook.description|length > 100 %}...{% endif %}
                </p>
                <div class="notebook-meta">
                    <span class="author">by {{ notebook.author.username }}</span>
                    <span class="views">{{ notebook.views }} views</span>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <h3>No analysis yet</h3>
        <p>Be the first to share CBDC/Stablecoin analysis</p>
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('upload_notebook') }}" class="upload-link">Share Analysis</a>
        {% else %}
        <a href="{{ url_for('register') }}" class="upload-link">Get Started</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<!-- Quick Stats -->
<div class="quick-stats">
    <div class="stats-grid">
        <div class="stat-item">
            <div class="stat-label">Total Analysis</div>
            <div class="stat-value">{{ notebooks|length if notebooks else 0 }}</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Contributors</div>
            <div class="stat-value">{{ notebooks|map(attribute='author.username')|unique|list|length if notebooks else 0 }}</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Total Views</div>
            <div class="stat-value">{{ notebooks|sum(attribute='views') if notebooks else 0 }}</div>
        </div>
    </div>
</div>
{% endblock %}
