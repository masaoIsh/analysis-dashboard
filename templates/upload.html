{% extends "base.html" %}

{% block title %}Upload Analysis - CBDC/Stablecoin Analysis{% endblock %}

{% block content %}
<div class="upload-container">
    <div class="upload-card">
        <div class="upload-header">
            <h2>Share Analysis</h2>
            <p>Upload your CBDC/Stablecoin research and analysis</p>
        </div>
        
        <form method="POST" enctype="multipart/form-data" id="uploadForm" class="upload-form">
            <!-- File Upload Section -->
            <div class="form-section">
                <label for="notebook" class="form-label">Notebook File</label>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h4>Drag & Drop your .ipynb file here</h4>
                        <p>or click to browse</p>
                        <input type="file" name="notebook" id="notebook" accept=".ipynb" required>
                        <button type="button" class="browse-btn" onclick="document.getElementById('notebook').click()">
                            <i class="fas fa-folder-open"></i>
                            Choose File
                        </button>
                    </div>
                </div>
                
                <div id="fileInfo" class="file-info" style="display: none;">
                    <div class="file-details">
                        <i class="fas fa-file-code"></i>
                        <span id="fileName"></span>
                        <button type="button" class="file-close" onclick="clearFile()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-help">
                    Supported formats: Jupyter Notebook (.ipynb), Google Colab (.ipynb), Python scripts (.py)
                </div>
            </div>

            <!-- Title and Visibility -->
            <div class="form-row">
                <div class="form-group">
                    <label for="title">Title</label>
                    <input type="text" id="title" name="title" 
                           placeholder="Enter a descriptive title for your notebook" required>
                    <div class="form-help">
                        This will be displayed as the main heading for your notebook
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="is_public">Visibility</label>
                    <div class="visibility-toggle">
                        <input type="checkbox" id="is_public" name="is_public" checked>
                        <label for="is_public" class="toggle-label">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Make public</span>
                        </label>
                    </div>
                    <div class="form-help">
                        Public notebooks can be viewed by anyone
                    </div>
                </div>
            </div>

            <!-- Description -->
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="4" 
                          placeholder="Describe what your notebook does, what insights it provides, or what you learned..."></textarea>
                <div class="form-help">
                    Help others understand what your analysis is about
                </div>
            </div>

            <!-- Tags -->
            <div class="form-group">
                <label for="tags">Tags</label>
                <input type="text" id="tags" name="tags" 
                       placeholder="python, data-analysis, machine-learning, visualization">
                <div class="form-help">
                    Add relevant tags separated by commas (e.g., cbdc, stablecoin, defi, regulation, analysis)
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <a href="{{ url_for('dashboard') }}" class="cancel-btn">
                    <i class="fas fa-times"></i>
                    Cancel
                </a>
                <button type="submit" class="submit-btn" id="submitBtn" disabled>
                    <i class="fas fa-upload"></i>
                    Share Analysis
                </button>
            </div>
        </form>
    </div>

    <!-- Upload Guidelines -->
    <div class="guidelines-card">
        <div class="guidelines-header">
            <h3>Upload Guidelines</h3>
        </div>
        
        <div class="guidelines-content">
            <div class="guidelines-section">
                <h4><i class="fas fa-check-circle"></i>What to include:</h4>
                <ul>
                    <li>Clear documentation and comments</li>
                    <li>Descriptive cell outputs</li>
                    <li>Relevant data sources</li>
                    <li>Key insights and conclusions</li>
                </ul>
            </div>
            
            <div class="guidelines-section">
                <h4><i class="fas fa-exclamation-triangle"></i>Best practices:</h4>
                <ul>
                    <li>Keep file size under 16MB</li>
                    <li>Use descriptive titles and tags</li>
                    <li>Include sample data if possible</li>
                    <li>Test your notebook before uploading</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('notebook');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const submitBtn = document.getElementById('submitBtn');

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFile(files[0]);
        }
    });

    // File input change
    fileInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            handleFile(e.target.files[0]);
        }
    });

    function handleFile(file) {
        if (file.name.endsWith('.ipynb')) {
            // Create a new FileList-like object
            const dt = new DataTransfer();
            dt.items.add(file);
            fileInput.files = dt.files;
            
            fileName.textContent = file.name;
            fileInfo.style.display = 'block';
            submitBtn.disabled = false;
            
            // Auto-fill title if empty
            if (!document.getElementById('title').value) {
                document.getElementById('title').value = file.name.replace('.ipynb', '');
            }
        } else {
            alert('Please select a valid .ipynb file');
        }
    }

    // Form validation
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        if (!fileInput.files.length) {
            e.preventDefault();
            alert('Please select a notebook file to upload');
        }
    });
});

function clearFile() {
    document.getElementById('notebook').value = '';
    document.getElementById('fileInfo').style.display = 'none';
    document.getElementById('submitBtn').disabled = true;
}
</script>
{% endblock %}
